<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Curvas de nivel – líneas de nivel para f(x,y) = c0 + cx·x + cy·y</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#0b1324;color:#e9eef7}
    .card{background:#121a33;border-color:#1d2a52}
    .form-control, .form-select{background:#0e1731;color:#e9eef7;border-color:#1d2a52}
    .form-control::placeholder{color:#9bb0d3}
    canvas{background:#0a0f22;border:1px solid #1d2a52;border-radius:.75rem}
    .muted{color:#9bb0d3}
    .pill{display:inline-block;padding:.15rem .5rem;border-radius:50rem;border:1px solid #1d2a52;font-size:.85rem}
    .table{color:#e9eef7}
    .table>:not(caption)>*>*{background-color:transparent}
    .color-dot{width:.9rem;height:.9rem;border-radius:50%;display:inline-block;vertical-align:middle;margin-right:.35rem}
    a{color:#9ec5fe}
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="mb-3 text-center">
      <h1 class="h3 fw-bold">Curvas (Líneas) de Nivel</h1>
      <p class="muted mb-0">Para funciones lineales de la forma <span class="pill">f(x,y) = c0 + cx·x + cy·y</span>. Ingrese los coeficientes y los valores de <span class="pill">k</span>.</p>
    </div>

    <div class="row g-4">
      <!-- Panel de entrada -->
      <div class="col-lg-5">
        <div class="card p-3">
          <h2 class="h5">1) Datos de la función</h2>
          <div class="row g-2">
            <div class="col-4">
              <label class="form-label">c0 (constante)</label>
              <input id="c0" class="form-control" type="number" step="any" placeholder="ej. 6" value="6" />
            </div>
            <div class="col-4">
              <label class="form-label">cx (coef. de x)</label>
              <input id="cx" class="form-control" type="number" step="any" placeholder="ej. -3" value="-3" />
            </div>
            <div class="col-4">
              <label class="form-label">cy (coef. de y)</label>
              <input id="cy" class="form-control" type="number" step="any" placeholder="ej. -2" value="-2" />
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Valores de k <span class="muted">(separados por coma)</span></label>
            <input id="kvals" class="form-control" type="text" placeholder="ej. -6, 0, 6, 12" value="-6,0,6,12" />
          </div>

          <div class="mt-3">
            <h2 class="h6">2) Rango gráfico</h2>
            <div class="row g-2">
              <div class="col-3">
                <label class="form-label">x min</label>
                <input id="xmin" class="form-control" type="number" step="any" value="-10" />
              </div>
              <div class="col-3">
                <label class="form-label">x max</label>
                <input id="xmax" class="form-control" type="number" step="any" value="10" />
              </div>
              <div class="col-3">
                <label class="form-label">y min</label>
                <input id="ymin" class="form-control" type="number" step="any" value="-10" />
              </div>
              <div class="col-3">
                <label class="form-label">y max</label>
                <input id="ymax" class="form-control" type="number" step="any" value="10" />
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button id="btnCalc" class="btn btn-primary">Calcular y Graficar</button>
            <button id="btnEjemplo" class="btn btn-outline-secondary">Ejemplo 6 − 3x − 2y</button>
            <button id="btnLimpiar" class="btn btn-outline-danger ms-auto">Limpiar</button>
          </div>

          <hr class="my-3"/>

          <div>
            <div class="small muted">La curva de nivel para cada <em>k</em> resulta en la recta:
              <div class="pill mt-2">cx·x + cy·y + (k − c0) = 0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resultados y gráfico -->
      <div class="col-lg-7">
        <div class="card p-3 mb-3">
          <h2 class="h5">Resultados</h2>
          <div id="equations" class="small"></div>
          <div class="table-responsive mt-2">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>k</th>
                  <th>Ecuación (forma general)</th>
                  <th>Forma pendiente (si aplica)</th>
                  <th>Intersección X</th>
                  <th>Intersección Y</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>

        <div class="card p-3">
          <h2 class="h5">Gráfico</h2>
          <canvas id="plot" width="900" height="520"></canvas>
          <div class="d-flex gap-2 mt-2">
            <button id="btnPNG" class="btn btn-outline-light btn-sm">Descargar PNG</button>
            <span class="muted small ms-auto">Use el rango para ajustar la vista.</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 text-center small muted">
      Hecho con ❤️ solo HTML + Bootstrap + JavaScript (canvas). Ideal para ejercicios tipo: f(x,y)=6−3x−2y.
    </div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);

    const palette = [
      '#4cc9f0','#f72585','#b5179e','#7209b7','#560bad','#480ca8','#3a0ca3','#3f37c9','#4895ef','#4361ee',
      '#2dd4bf','#10b981','#22c55e','#eab308','#f59e0b','#ef4444','#fb7185'
    ];

    function parseKValues(str){
      return str
        .split(/[,\s]+/)
        .map(s=>s.trim())
        .filter(s=>s.length>0)
        .map(Number)
        .filter(v=>Number.isFinite(v));
    }

    function fmt(n){
      if(!Number.isFinite(n)) return '-';
      const v = Math.abs(n) < 1e-9 ? 0 : n;
      return v.toLocaleString('es-SV',{maximumFractionDigits:6});
    }

    function lineString(cx,cy,c){
      // Representa cx·x + cy·y + c = 0 con signos bonitos
      const s = (a, sym) => {
        if (Math.abs(a) < 1e-12) return '';
        const sign = a>=0?'+':'−';
        const aval = fmt(Math.abs(a));
        return ` ${sign} ${aval}${sym}`;
      };
      const first = (a,sym)=>{
        if (Math.abs(a) < 1e-12) return '';
        return `${a<0?'−':''}${fmt(Math.abs(a))}${sym}`;
      };
      let out = '';
      out += Math.abs(cx)>1e-12 ? first(cx,'x') : '';
      out += s(cy,'y');
      out += s(c,'');
      if(out.startsWith(' ')) out = out.slice(1);
      if(out==='' ) out = '0';
      return out + ' = 0';
    }

    function slopeForm(cx,cy,c){
      if (Math.abs(cy) > 1e-12){
        const m = -cx/cy;
        const b = -c/cy;
        return `y = ${fmt(m)}·x ${b>=0?'+':'−'} ${fmt(Math.abs(b))}`;
      } else if (Math.abs(cx) > 1e-12){
        const x0 = -c/cx;
        return `x = ${fmt(x0)}`;
      } else {
        return c===0 ? 'Todos los puntos (identidad 0=0)' : 'Sin solución (contradicción)';
      }
    }

    function intersections(cx,cy,c){
      // cx·x + cy·y + c = 0
      let xInt = Number.NaN, yInt = Number.NaN;
      if (Math.abs(cx) > 1e-12) xInt = -c/cx; // y=0
      if (Math.abs(cy) > 1e-12) yInt = -c/cy; // x=0
      return {xInt, yInt};
    }

    function computeLines(){
      const c0 = Number($('#c0').value);
      const cx = Number($('#cx').value);
      const cy = Number($('#cy').value);
      const ks = parseKValues($('#kvals').value);
      const lines = ks.map((k,i)=>{
        const c = (k - c0); // cx·x + cy·y + (k-c0)=0
        return {k, cx, cy, c, color: palette[i % palette.length]};
      });
      return {c0,cx,cy, lines};
    }

    function renderTable(){
      const {lines} = computeLines();
      const tbody = $('#tbody');
      tbody.innerHTML = '';
      lines.forEach((L)=>{
        const eq = lineString(L.cx, L.cy, L.c);
        const sf = slopeForm(L.cx, L.cy, L.c);
        const {xInt, yInt} = intersections(L.cx, L.cy, L.c);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="color-dot" style="background:${L.color}"></span>${fmt(L.k)}</td>
          <td><code>${eq}</code></td>
          <td><code>${sf}</code></td>
          <td>(${fmt(xInt)}, 0)</td>
          <td>(0, ${fmt(yInt)})</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // --- Drawing ---
    function draw(){
      const {lines} = computeLines();
      const xmin = Number($('#xmin').value), xmax = Number($('#xmax').value);
      const ymin = Number($('#ymin').value), ymax = Number($('#ymax').value);
      const pad = 40;
      const canvas = $('#plot');
      const ctx = canvas.getContext('2d');
      const W = canvas.width, H = canvas.height;

      // helpers
      const X = x => pad + (x - xmin) / (xmax - xmin) * (W - 2*pad);
      const Y = y => H - pad - (y - ymin) / (ymax - ymin) * (H - 2*pad);

      // clear
      ctx.clearRect(0,0,W,H);

      // grid
      ctx.lineWidth = 1; ctx.strokeStyle = '#17315e';
      for(let gx=Math.ceil(xmin); gx<=xmax; gx++){
        const x = X(gx);
        ctx.beginPath(); ctx.moveTo(x, pad); ctx.lineTo(x, H-pad); ctx.stroke();
      }
      for(let gy=Math.ceil(ymin); gy<=ymax; gy++){
        const y = Y(gy);
        ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(W-pad, y); ctx.stroke();
      }

      // axes
      ctx.lineWidth = 2; ctx.strokeStyle = '#9bb0d3';
      if (xmin<0 && xmax>0){
        const x0 = X(0); ctx.beginPath(); ctx.moveTo(x0, pad); ctx.lineTo(x0, H-pad); ctx.stroke();
      }
      if (ymin<0 && ymax>0){
        const y0 = Y(0); ctx.beginPath(); ctx.moveTo(pad, y0); ctx.lineTo(W-pad, y0); ctx.stroke();
      }

      // ticks & labels
      ctx.fillStyle = '#9bb0d3'; ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      for(let gx=Math.ceil(xmin); gx<=xmax; gx++){
        const x = X(gx), y0 = Y(0);
        if (ymin < 0 && ymax > 0){ ctx.fillText(gx.toString(), x-4, y0+14); }
      }
      for(let gy=Math.ceil(ymin); gy<=ymax; gy++){
        const y = Y(gy), x0 = X(0);
        if (xmin < 0 && xmax > 0){ ctx.fillText(gy.toString(), x0+6, y+4); }
      }

      // draw each line segment inside the box
      lines.forEach((L)=>{
        const {cx, cy, c} = L; // cx·x + cy·y + c = 0
        const pts = [];

        function yAt(x){ return -(cx*x + c)/cy; }
        function xAt(y){ return -(cy*y + c)/cx; }

        // try vertical edges x=xmin, x=xmax
        if (Math.abs(cy) > 1e-12){
          const y1 = yAt(xmin); if (y1>=ymin && y1<=ymax) pts.push({x:xmin,y:y1});
          const y2 = yAt(xmax); if (y2>=ymin && y2<=ymax) pts.push({x:xmax,y:y2});
        }
        // try horizontal edges y=ymin, y=ymax
        if (Math.abs(cx) > 1e-12){
          const x1 = xAt(ymin); if (x1>=xmin && x1<=xmax) pts.push({x:x1,y:ymin});
          const x2 = xAt(ymax); if (x2>=xmin && x2<=xmax) pts.push({x:x2,y:ymax});
        }
        // deduplicate close points
        for(let i=0;i<pts.length;i++){
          for(let j=i+1;j<pts.length;j++){
            if (Math.hypot(pts[i].x-pts[j].x, pts[i].y-pts[j].y) < 1e-6){ pts.splice(j,1); j--; }
          }
        }
        if (pts.length < 2){
          // handle degenerate cases: either no intersection or the line is coincident with the box (rare)
          return;
        }
        const [p1, p2] = [pts[0], pts[1]];
        ctx.lineWidth = 2; ctx.strokeStyle=L.color;
        ctx.beginPath();
        ctx.moveTo(X(p1.x), Y(p1.y));
        ctx.lineTo(X(p2.x), Y(p2.y));
        ctx.stroke();
      });
    }

    function downloadPNG(){
      const canvas = $('#plot');
      const link = document.createElement('a');
      link.download = 'curvas_de_nivel.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    function setEjemplo(){
      $('#c0').value = 6; $('#cx').value = -3; $('#cy').value = -2; $('#kvals').value='-6,0,6,12';
      $('#xmin').value=-10; $('#xmax').value=10; $('#ymin').value=-10; $('#ymax').value=10;
      renderTable(); draw();
    }

    function limpiar(){
      $('#kvals').value = '';
      $('#tbody').innerHTML = '';
      const ctx = $('#plot').getContext('2d');
      ctx.clearRect(0,0,$('#plot').width,$('#plot').height);
    }

    // events
    $('#btnCalc').addEventListener('click', ()=>{ renderTable(); draw(); });
    $('#btnPNG').addEventListener('click', downloadPNG);
    $('#btnEjemplo').addEventListener('click', setEjemplo);
    $('#btnLimpiar').addEventListener('click', limpiar);

    // auto-render initial example
    setEjemplo();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
