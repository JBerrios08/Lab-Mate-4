<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Curvas de Nivel – cálculo y procedimiento</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1324; --card:#121a33; --muted:#9bb0d3; --border:#1d2a52; --ink:#e9eef7;
      --hi1:#ffd166; --hi2:#06d6a0; --hi3:#ff006e; --hi4:#9ec5fe;
    }
    body{background:var(--bg);color:var(--ink)}
    .card{background:var(--card);border-color:var(--border)}
    .form-control,.form-select{background:#0e1731;color:var(--ink);border-color:var(--border)}
    .form-control::placeholder{color:var(--muted)}
    canvas{background:#0a0f22;border:1px solid var(--border);border-radius:.75rem}
    .muted{color:var(--muted)}
    .pill{display:inline-block;padding:.15rem .5rem;border-radius:50rem;border:1px solid var(--border);font-size:.85rem}
    .table{color:var(--ink)}
    .table>:not(caption)>*>*{background-color:transparent}
    .color-dot{width:.9rem;height:.9rem;border-radius:50%;display:inline-block;vertical-align:middle;margin-right:.35rem}
    a{color:var(--hi4)}
    code{white-space:pre-wrap}
    /* — mejoras de legibilidad del procedimiento — */
    #procBody .step-title{font-weight:800;font-size:1.05rem;margin:.5rem 0}
    #procBody .step-title.hi1{color:var(--hi1)}
    #procBody .step-title.hi2{color:var(--hi2)}
    #procBody .case{margin:.5rem 0 .75rem;border-left:3px solid var(--border);padding-left:.6rem}
    #procBody code{font-weight:700}
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="mb-3 text-center">
      <h1 class="h3 fw-bold">Curvas (Líneas) de Nivel</h1>
      <p class="muted mb-0">Función lineal: <span class="pill">f(x,y) = c0 + cx·x + cy·y</span>. Ingrese coeficientes y valores de <span class="pill">k</span>.</p>
    </div>

    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card p-3">
          <h2 class="h5">1) Datos de la función</h2>
          <div class="row g-2">
            <div class="col-4">
              <label class="form-label">c0</label>
              <input id="c0" class="form-control" type="number" step="any" value="6" />
            </div>
            <div class="col-4">
              <label class="form-label">cx</label>
              <input id="cx" class="form-control" type="number" step="any" value="-3" />
            </div>
            <div class="col-4">
              <label class="form-label">cy</label>
              <input id="cy" class="form-control" type="number" step="any" value="-2" />
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Valores de k <span class="muted">(coma o espacio)</span></label>
            <input id="kvals" class="form-control" type="text" value="-6 0 6 12" />
          </div>

          <div class="mt-3">
            <h2 class="h6">2) Rango gráfico</h2>
            <div class="row g-2">
              <div class="col-3"><label class="form-label">x min</label><input id="xmin" class="form-control" type="number" step="any" value="-10" /></div>
              <div class="col-3"><label class="form-label">x max</label><input id="xmax" class="form-control" type="number" step="any" value="10" /></div>
              <div class="col-3"><label class="form-label">y min</label><input id="ymin" class="form-control" type="number" step="any" value="-10" /></div>
              <div class="col-3"><label class="form-label">y max</label><input id="ymax" class="form-control" type="number" step="any" value="10" /></div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button id="btnCalc" class="btn btn-primary">Calcular / Mostrar procedimiento</button>
            <button id="btnEjemplo" class="btn btn-outline-secondary">Ejemplo 6−3x−2y</button>
            <button id="btnLimpiar" class="btn btn-outline-danger ms-auto">Limpiar</button>
          </div>

          <hr class="my-3"/>

          <div class="small muted">
            Para cada <em>k</em>, la recta de nivel (normalizada con signo positivo) queda: <span class="pill">a·x + b·y + c = 0</span>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card p-3 mb-3">
          <h2 class="h5">Resultados</h2>
          <div class="table-responsive mt-2">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>k</th>
                  <th>Ecuación (general)</th>
                  <th>Forma pendiente/intersección</th>
                  <th>Intersección X</th>
                  <th>Intersección Y</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>

        <div class="card p-3 mb-3">
          <h2 class="h5">Procedimiento detallado</h2>
          <div id="procBody" class="small"></div>
        </div>

        <div class="card p-3">
          <h2 class="h5">Gráfico</h2>
          <canvas id="plot" width="900" height="520"></canvas>
          <div class="d-flex gap-2 mt-2">
            <button id="btnPNG" class="btn btn-outline-light btn-sm">Descargar PNG</button>
            <span class="muted small ms-auto">Ajuste el rango para ver mejor.</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 text-center small muted">Jaime Fernando Berrios Ortiz</div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);

    const palette = ['#4cc9f0','#f72585','#b5179e','#7209b7','#560bad','#480ca8',
                     '#3a0ca3','#3f37c9','#4895ef','#4361ee','#2dd4bf','#10b981',
                     '#22c55e','#eab308','#f59e0b','#ef4444','#fb7185'];

    const EPS = 1e-12;

    function parseKValues(str){
      return str.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean).map(Number).filter(v=>Number.isFinite(v));
    }
    function fmt(n){ if(!Number.isFinite(n)) return '-'; const v = Math.abs(n)<1e-9?0:n; return v.toLocaleString('es-SV',{maximumFractionDigits:6}); }

    // Normaliza el signo multiplicando por -1 cuando el primer coeficiente no nulo es negativo.
    function normalizeSign(cx,cy,c){
      let s = 1;
      if (Math.abs(cx) > EPS) s = cx < 0 ? -1 : 1;
      else if (Math.abs(cy) > EPS) s = cy < 0 ? -1 : 1;
      else if (Math.abs(c)  > EPS) s = c  < 0 ? -1 : 1;
      return {cx: cx*s, cy: cy*s, c: c*s, s};
    }

    function lineString(cx,cy,c){
      const N = normalizeSign(cx,cy,c);
      cx = N.cx; cy = N.cy; c = N.c;
      const seg = (a, sym) => { if (Math.abs(a)<EPS) return ''; const sign=a>=0?'+':'−'; const aval = fmt(Math.abs(a)); return ` ${sign} ${aval}${sym}`; };
      const first = (a,sym)=>{ if (Math.abs(a)<EPS) return ''; return `${a<0?'−':''}${fmt(Math.abs(a))}${sym}`; };
      let out = '';
      out += Math.abs(cx)>EPS ? first(cx,'x') : '';
      out += seg(cy,'y');
      out += seg(c,'');
      if(out.startsWith(' ')) out = out.slice(1);
      if(out==='') out='0';
      return out + ' = 0';
    }

    function slopeForm(cx,cy,c){
      // forma pendiente-intersección es invariante a multiplicar por -1, pero normalizamos para mostrar bonito
      const N = normalizeSign(cx,cy,c); cx=N.cx; cy=N.cy; c=N.c;
      if (Math.abs(cy) > EPS){ const m = -cx/cy, b = -c/cy; return `y = ${fmt(m)}·x ${b>=0?'+':'−'} ${fmt(Math.abs(b))}`; }
      else if (Math.abs(cx) > EPS){ const x0 = -c/cx; return `x = ${fmt(x0)}`; }
      else { return c===0 ? 'Identidad (0=0)' : 'Sin solución'; }
    }

    function intersections(cx,cy,c){
      let xInt = Number.NaN, yInt = Number.NaN;
      if (Math.abs(cx)>EPS) xInt = -c/cx; // y=0
      if (Math.abs(cy)>EPS) yInt = -c/cy; // x=0
      return {xInt,yInt};
    }

    function computeLines(){
      const c0 = Number($('#c0').value);
      const cx = Number($('#cx').value);
      const cy = Number($('#cy').value);
      const ks = parseKValues($('#kvals').value);
      const lines = ks.map((k,i)=>({k, cx, cy, c:(k-c0), color: palette[i%palette.length]}));
      return {c0,cx,cy,lines};
    }

    function renderTable(){
      const {lines} = computeLines();
      const tbody = $('#tbody');
      tbody.innerHTML='';
      lines.forEach(L=>{
        const eq = lineString(L.cx,L.cy,L.c);                 // mostrado normalizado (positivo)
        const sf = slopeForm(L.cx,L.cy,L.c);
        const {xInt,yInt} = intersections(L.cx,L.cy,L.c);     // cálculo con coeficientes originales
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="color-dot" style="background:${L.color}"></span>${fmt(L.k)}</td>
          <td><code>${eq}</code></td>
          <td><code>${sf}</code></td>
          <td>(${fmt(xInt)}, 0)</td>
          <td>(0, ${fmt(yInt)})</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderProcedure(){
      const c0 = Number($('#c0').value);
      const cx = Number($('#cx').value);
      const cy = Number($('#cy').value);
      const ks = parseKValues($('#kvals').value);

      // Paso: forma original
      const sig = v => v>=0?'+':'−';
      const abs = v => fmt(Math.abs(v));

      // Normalizamos (multiplicar por -1 si hace falta) a*x + b*y + (k-c0) = 0 con a,b >= 0 en lo posible
      const A = -cx;     // mover 6 al otro lado: cx x + cy y = k - c0 ⇒ (-cx)x + (-cy)y = -(k-c0)
      const B = -cy;

      let html = '';
      html += `<div class="step-title hi1">Ejercicio</div>`;
      html += `<div><code><strong>f(x,y) = ${fmt(c0)} ${sig(cx)} ${abs(cx)}x ${sig(cy)} ${abs(cy)}y = k</strong></code></div>`;

      html += `<div class="step-title hi2">Paso 1: Reordenar</div>`;
      html += `<div class="case"><div><code>${fmt(c0)} ${sig(cx)} ${abs(cx)}x ${sig(cy)} ${abs(cy)}y = k</code></div>
               <div><code>${cx}x ${cy>=0?'+':''}${cy}y = k − ${fmt(c0)}</code></div>
               <div><em>Multiplicamos por −1 para dejar coeficientes positivos:</em></div>
               <div><code>${fmt(A)}x + ${fmt(B)}y − (k − ${fmt(c0)}) = 0</code></div>
               <div><strong>Ecuación general (normalizada):</strong> <code>${fmt(A)}x + ${fmt(B)}y − (k − ${fmt(c0)}) = 0</code></div></div>`;

      html += `<div class="step-title">Paso 2: Casos para distintos valores de k</div>`;

      ks.forEach((k, idx)=>{
        const c = k - c0;
        // Intersecciones con la forma normalizada: A x + B y − c = 0 ⇒ A x + B y = c
        const xCut = Math.abs(A)>EPS ?  c / A : NaN; // y=0 → A x = c
        const yCut = Math.abs(B)>EPS ?  c / B : NaN; // x=0 → B y = c
        html += `<div class="case">
          <div><strong style="color:var(--hi3)">Caso ${idx+1}: k = ${fmt(k)}</strong></div>
          <div><code>${fmt(A)}x + ${fmt(B)}y − (${fmt(k)} − ${fmt(c0)}) = 0</code></div>
          <div class="mt-1"><em>Si</em> <code>x = 0</code> ⇒ <code>${fmt(B)}y = ${fmt(c)}</code> ⇒ <code>y = ${fmt(yCut)}</code> &nbsp;—&nbsp;Punto: <code>(0, ${fmt(yCut)})</code></div>
          <div class="mt-1"><em>Si</em> <code>y = 0</code> ⇒ <code>${fmt(A)}x = ${fmt(c)}</code> ⇒ <code>x = ${fmt(xCut)}</code> &nbsp;—&nbsp;Punto: <code>(${fmt(xCut)}, 0)</code></div>
        </div>`;
      });

      $('#procBody').innerHTML = html;
    }

    // --- Dibujo ---
    function draw(){
      const {lines} = computeLines();
      const xmin = Number($('#xmin').value), xmax = Number($('#xmax').value);
      const ymin = Number($('#ymin').value), ymax = Number($('#ymax').value);
      const pad = 40; const canvas = $('#plot'); const ctx = canvas.getContext('2d');
      const W = canvas.width, H = canvas.height;
      const X = x => pad + (x - xmin)/(xmax - xmin) * (W - 2*pad);
      const Y = y => H - pad - (y - ymin)/(ymax - ymin) * (H - 2*pad);
      ctx.clearRect(0,0,W,H);
      // grid
      ctx.lineWidth = 1; ctx.strokeStyle = '#17315e';
      for(let gx=Math.ceil(xmin); gx<=xmax; gx++){ const x=X(gx); ctx.beginPath(); ctx.moveTo(x,pad); ctx.lineTo(x,H-pad); ctx.stroke(); }
      for(let gy=Math.ceil(ymin); gy<=ymax; gy++){ const y=Y(gy); ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(W-pad,y); ctx.stroke(); }
      // axes
      ctx.lineWidth = 2; ctx.strokeStyle = '#9bb0d3';
      if (xmin<0 && xmax>0){ const x0=X(0); ctx.beginPath(); ctx.moveTo(x0,pad); ctx.lineTo(x0,H-pad); ctx.stroke(); }
      if (ymin<0 && ymax>0){ const y0=Y(0); ctx.beginPath(); ctx.moveTo(pad,y0); ctx.lineTo(W-pad,y0); ctx.stroke(); }
      // labels
      ctx.fillStyle = '#9bb0d3'; ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      if (ymin<0 && ymax>0){ for(let gx=Math.ceil(xmin); gx<=xmax; gx++){ const x=X(gx), y0=Y(0); ctx.fillText(gx.toString(), x-4, y0+14); } }
      if (xmin<0 && xmax>0){ for(let gy=Math.ceil(ymin); gy<=ymax; gy++){ const y=Y(gy), x0=X(0); ctx.fillText(gy.toString(), x0+6, y+4); } }
      // lines
      lines.forEach(L=>{
        const {cx,cy,c} = L; const pts=[];
        function yAt(x){ return -(cx*x + c)/cy; }
        function xAt(y){ return -(cy*y + c)/cx; }
        if (Math.abs(cy)>EPS){ const y1=yAt(xmin); if(y1>=ymin && y1<=ymax) pts.push({x:xmin,y:y1}); const y2=yAt(xmax); if(y2>=ymin && y2<=ymax) pts.push({x:xmax,y:y2}); }
        if (Math.abs(cx)>EPS){ const x1=xAt(ymin); if(x1>=xmin && x1<=xmax) pts.push({x:x1,y:ymin}); const x2=xAt(ymax); if(x2>=xmin && x2<=xmax) pts.push({x:x2,y:ymax}); }
        for(let i=0;i<pts.length;i++){ for(let j=i+1;j<pts.length;j++){ if (Math.hypot(pts[i].x-pts[j].x, pts[i].y-pts[j].y)<1e-6){ pts.splice(j,1); j--; } } }
        if (pts.length<2) return;
        const [p1,p2]=[pts[0],pts[1]]; ctx.lineWidth=2; ctx.strokeStyle=L.color; ctx.beginPath(); ctx.moveTo(X(p1.x),Y(p1.y)); ctx.lineTo(X(p2.x),Y(p2.y)); ctx.stroke();
      });
    }

    function downloadPNG(){ const canvas=$('#plot'); const a=document.createElement('a'); a.download='curvas_de_nivel.png'; a.href=canvas.toDataURL('image/png'); a.click(); }
    function setEjemplo(){ $('#c0').value=6; $('#cx').value=-3; $('#cy').value=-2; $('#kvals').value='-6, 0, 6, 12'; $('#xmin').value=-10; $('#xmax').value=10; $('#ymin').value=-10; $('#ymax').value=10; renderTable(); renderProcedure(); draw(); }
    function limpiar(){ $('#kvals').value=''; $('#tbody').innerHTML=''; $('#procBody').innerHTML=''; const ctx=$('#plot').getContext('2d'); ctx.clearRect(0,0,$('#plot').width,$('#plot').height); }

    $('#btnCalc').addEventListener('click', ()=>{ renderTable(); renderProcedure(); draw(); });
    $('#btnPNG').addEventListener('click', downloadPNG);
    $('#btnEjemplo').addEventListener('click', setEjemplo);
    $('#btnLimpiar').addEventListener('click', limpiar);

    // Inicializar con el ejemplo
    setEjemplo();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
